\cleardoublepage

\chapter{Introducción}

\section{Motivación}
\label{ch:Capitulo1}

Al buscar una solución de domótica para el hogar, se dispone de muchas marcas que ofrecen dispositivos individuales para controlar o monitorizar una casa, o soluciones integrales. Para la mayoría de las marcas, se prohíbe expresamente, realizar ingeniería inversa o pruebas de caja negra que permitan desarrollar productos que se conviertan en competencia del producto adquirido. Si la intención de una persona es instalar una solución domótica que le permita explorar nuevas posibilidades, experimentar prototipos y aprender su funcionamiento interno, se debe buscar una solución libre ya creada, ajustándose a sus normas de diseño, o bien implementar desde la base, o partiendo de un trabajo con licencia libre, que permita expandir su diseño como se quiera. ¿No son suficientes las soluciones aportadas en el sector privado de la domótica? De hecho, son suficientes, y exceden incluso las necesidades para según que escenarios. No se trata de un problema de carencia. El problema reside en las condiciones que hay que contratar para dichas soluciones. La falta de libertad por parte del usuario final para explorar y modificar los productos contratados. No queda espacio en estas marcas para las personas que desean aprender mediante el ejercicio práctico del prototipado o modificación de un producto. Que el camino del paradigma \gls{iot} en domótica sea privativo responde a intereses comerciales donde las marcas se lucran, no sólo con la venta de productos, sino con el tratamiento de los datos de dichos productos, y creando ecosistemas que tratan de imponerse en un oligopolio amparado por los actores con más peso en el sector tecnológico.

\vspace{1cm}

La domótica ha sufrido un crecimiento acelerado en los últimos años gracias a la interconexión de dispositivos electrónicos gestionados con aplicaciones móviles. Este fenómeno social de \gls{app} para controlar la casa se basa en la venta de kits de domótica \Gls{pnp}, que requieren únicamente de la instalación de una aplicación de móvil gratuita y la adquisición de los productos ofertados por los fabricantes que operen en los ecosistemas de dichas aplicaciones. Una gran competencia entre empresas ha surgido a raíz de este planteamiento, ofreciendo una gama extensa de electrodomésticos que pueden combinarse, en algunos casos incluso, interoperar, entre distintas marcas. Esta disputa se está desarrollando en una etapa de incertidumbre, causada por la fase experimental de productos que se ofertan a los consumidores, ya que aún no existe una necesidad real de domótica en las personas, como ocurre, por ejemplo, con un \gls{smartphone}. Se siguen buscando estrategias de marketing para crear dicha necesidad mediante productos que aportan confort o gestión remota de electrodomésticos del hogar. Tomemos por ejemplo los sistemas de iluminación con múltiples configuraciones de intensidad, o el tracking de actividad, los históricos de peso en una báscula, etc. Independientemente de las ideas presentadas, ya se están estableciendo unas pautas comunes en todos los actores del sector de la domótica. Y es en estas pautas donde aparece nuestra preocupación a la hora de optar por las soluciones con más presencia del mercado (véase Amazon, Google o Xiaomi), que motivan en este proyecto la búsqueda de una suite de domótica que se aleje de sus prácticas y tendencias. A continuación, se describen los puntos principales que serán objeto de análisis, y donde se encuentran problemas que han sido creados, para beneficio de las marcas, y en detrimento del usuario final que los adquiere.

\vspace{1cm}

En primer lugar, la estrategia es ofrecer dispositivos de distintos rangos de precio, que están diseñados para utilizarse de forma exclusiva en los ecosistemas de cada marca. Esto implica supeditarse a las imposiciones técnicas de cada fabricante, incluyendo la forma en la que funcionan dichos dispositivos, sin poder modificar las especificaciones y funcionamientos de los mismos. En esencia, cajas negras, que desconocemos su funcionamiento interno. Esto se extiende a la posibilidad de ampliar sus funciones o repararlos por cuenta propia (tal y como se recoge en las cláusulas de uso definidas en los manuales de todas las marcas). Se deja al usuario final a merced de un contrato establecido con los fabricantes, incluyendo su soporte de post-venta y servicio técnico. Por escenificarlo en un ejemplo análogo, si se adquiere un coche, no se impide que se pueda arreglar dicho coche con piezas genéricas, ni que se esté obligado a repararlo en la casa oficial de la marca. Si bien, es cierto que los dispositivos ofertados por las grandes marcas están habitualmente basados en estándares y de protocolos de comunicación de dominio publico, se aseguran de torcer la implementación y desarrollo del producto, añadiendo capas de funcionamiento pensadas para inhabilitar la operatividad de un producto en el ecosistema de una marca competidora. Esta tendencia, por suerte, parece estar empezando a diluirse, y es más fácil encontrar ahora dispositivos que funcionan entre múltiples plataformas simultáneamente.

\vspace{1cm}

En segundo lugar, preocupa la aceptación de las políticas de uso y privacidad de las aplicaciones de las distintas plataformas, que obliga a un uso restringido de los productos según las pautas del vendedor, así como la cesión de la privacidad del usuario final. Es decir, que toda interacción del usuario con los dispositivos, así como otros datos personales obtenidos en procesos de registro de sus aplicaciones, incluyendo \gls{dcp} de carácter bajo, medio, y alto según qué dispositivos, serán monitorizados y enviados a servidores para ser procesados, sin tener claro con qué fin.

\vspace{1cm}

Toda esta transferencia de datos, en todas las plataformas, está planteada para usar una solución domótica en servicios en la nube, lo que implica un envío continuo de datos a servicios externos, con medidas de seguridad desconocidas, sin garantías reales de protección de datos, y bajo la eterna dependencia del funcionamiento de dichos servicios, que operan en países con leyes que podrían no estar en sintonía con la legalidad del país en el que vive el usuario final. También hay que tener en cuenta que todas estas empresas se reservan el derecho unilateral de cambiar sus condiciones de uso y política de privacidad cuando crean convenientes sin consentimiento del usuario final. Y merece una mención especial que, las pruebas ejecutadas en las aplicaciones móviles de los casos que se analizarán en el capítulo \ref{ch:Capitulo2} coinciden en una misma máxima: Cuanto más restrictiva sea la configuración de privacidad por parte del usuario,
menor será la utilidad de la aplicación.

\vspace{1cm}

Este documento no profundizará en los problemas de privacidad de datos de los usuarios para estas aplicaciones, ya que, de por sí, se requiere un estudio separado de este proyecto, que debe apoyarse debidamente en una base de conocimiento sobre legislación, que excede las competencias adquiridas en una carrera de vertiente tecnológica como la ingeniería informática. Sin embargo, en los itinerarios de un grado de tecnología, que incluye materias como Auditoría Informática y/o Ética, Legislación y Profesión, como es el caso de los autores de este documento, y que por consecuencia dotan de un conocimiento básico sobre términos como \gls{dcp}, su tratamiento y la regulación de la \gls{lopd} y \gls{rgpd} en España por parte de la \gls{aepd}, se puede concluir que todas estas aplicaciones, sin ser ilegales, se encuentran demasiado cerca de la alegalidad, o se mueven en términos demasiado ambiguos, faltos de transparencia y claridad, como para considerarse realmente confiables y comprometidas con los datos privados de sus usuarios. Puede encontrase una explicación más extensa en el capítulo~\ref{ch:Capitulo2.1}, sección de política y privacidad de los contratos.

\vspace{1cm}

Y en último lugar, como motivación adicional para el desarrollo de una solución domótica independiente y libre, se encuentra el problema que bautizaremos como "Miles de kilómetros por metro", es decir, que para encender una interruptor a un metro del usuario, la operativa de la infraestructura necesaria para que la acción ocurra implica que los datos de dicha acción tienen que viajar miles de kilómetros desde el móvil del usuario, hasta llegar a los servidores necesarios, para algo tan trivial como encender un interruptor. Esto carece de justificación, salvo de que exista la intención de usar los datos del usuario para nutrir \gls{dataset} para \gls{machinelearning} o para su procesamiento en estrategias de marketing o dotar de tracking a empresas de terceros, además, en caso de caída de la red de internet (ya sea por el \gls{isp}, por un bloqueo del servicio en origen o destino, etc.) no se puede operar con normalidad los dispositivos en la red local del hogar, lo cual no está justificado. Es entendible que, ante desconexión de la red de internet no se pueda operar de manera remota la domótica del hogar, pero un router doméstico puede seguir ofreciendo operatividad a la red local, incluyendo la gestión domótica desde dentro de la red, para cubrir la funcionalidad básica.

\vspace{1cm}

Por todo esto, el objetivo es investigar y crear un prototipo de solución domótica (\textit{suite domótica} en adelante) que evite estas pautas anteriormente descritas. Sustentado por un software libre, con unas librerías accesibles de manera pública, basado en un hardware fácil de adquirir y que con una base fundamental de conocimientos de electrónica e informática, dicha suite pueda ser manipulada y personalizada con relativa facilidad. Una solución integral de domótica que incluya el software necesario para operar localmente en casa y externamente a través de la red de internet, con una \gls{app}, que no precise de servicios de terceros, ni de la aceptación de políticas de uso privativas, ya que el responsable final de los datos sera el propio usuario. En el capítulo~\ref{ch:Capitulo2} se analizarán las distintas soluciones existente para las distintas capas físicas y de software, y se valorarán cuáles se acercan más a los planteamientos en la sección de objetivos~\ref{ch:Capitulo2.3}. Por otro lado, para entender qué tan complejo es crear una suite de domótica libre desde la base, y comprender las técnicas e implementación de cada etapa, esta documentación estará apoyada en la creación un prototipo funcional.

\vspace{1cm}

No se pretende crear una solución disruptiva en el mercado de la domótica, que enfrente las soluciones ya existentes ofertadas por otras marcas, ni aportar un protocolo nuevo de comunicaciones entre dispositivos \gls{iot}. Principalmente es conocer los requisitos necesarios para la creación de una suite domótica y la capacidad necesaria de un usuario final para que pueda instalar su propio sistema de domótica personalizado, sin depender de servicios a terceros. Esto responde también al propio interés de aprendizaje y compresión de tecnologías nuevas, un hábito de los estudiantes de ingeniería inculcado desde los primeros años de formación, y frecuentemente existente antes de dicha formación.

\vspace{1cm}

Las soluciones que pueden adquirirse actualmente en el mercado, tras lo años de prueba y error por parte de las marcas, han alcanzado un proceso de instalación muy sencillo para los usuarios finales. Esto, sin embargo, será difícil de abordar en este proyecto, ya que será necesario que el usuario disponga de conocimientos específicos de informática para interpretar los pasos que estarán documentados, pero es posible alcanzar un punto intermedio, que requiera de unos conocimientos moderados, pero que este lo suficientemente guiado y configurado como para ser trivial. Se intentará minimizar, en la medida de lo posible, todos los pasos necesarios para montar la infraestructura, incluyendo la instalación de software y la programación de \gls{script}, para que el prototipo pueda ser exportado con facilidad y replicarse nuevamente ahorrando tiempo, y simplificando el proceso.

\vspace{1cm}

Crear una suite domótica genérica puede cubrir la vertiente de aprendizaje, pero se quiere aportar algún ejemplo de cómo esta generalidad puede cubrir necesidades de casos concretos. Esta suite debe proveer de toda la arquitectura necesaria para que su flexibilidad de configuración pueda cubrir casos de uso concretos no previstos. Se ha decidido probar el prototipo de la suite de domótica resultante de este proyecto para ayudar con el control de ambiente de una bodega situada en el sótano de una casa, y el sistema de iluminación de dicha bodega.

\section{Objetivos}
\label{ch:Capitulo1.1}

Diseñar e implementar una solución integral de domótica modular, con un proceso sencillo de agregación de dispositivos a dicha suite que sea flexible ante escenarios no previstos.
\begin{itemize}
  \item Investigación, selección, instalación y configuración de un stack de servicios que permitan controlar la suite de domótica desde un servidor físico que actuará como nodo principal.

  \item Desarrollo de una aplicación móvil que permitir al usuario interactuar mediante una API-REST con dicho servidor para ejecutar las acciones y configuraciones, que solicitando el número de permisos más básicos demuestre que el exceso de permisos solicitados por las marcas responde sólo a interés empresariales y no funcionales.

  \item Desarrollar un sistema de adhesión de dispositivos a la suite domótica mediante un \gls{wizard} en la aplicación móvil.
  
  \item Aplicar la solución en un escenario simulado para monitorizar el ambiente de una bodega y controlar el sistema de luces en las escaleras de acceso de forma remota, todo ello mediante una aplicación de móvil.
  
  \item Mantener el desarrollo de un prototipo dentro de un rango de precio considerado bajo.
\end{itemize}

\section{Plan de trabajo}
\label{ch:Capitulo1.2}

El diseño de una suite de domótica, aun creándose desde cero, debe aprovechar al máximo las tecnologías y desarrollos de software libres existentes, ya que éste es precisamente el mayor potencial del desarrollo colaborativo tan característico del software libre, que incluyen una extensa comunidad que día a día mejoran el rendimiento y seguridad de cada uno de los módulos que puedan componer este proyecto. Esto implica un estudio previo de las diferentes opciones disponibles, y una selección del software y hardware que mejor se ajuste a nuestros objetivos, más detallados en el capitulo ~\ref{ch:Capitulo3}. Podemos separar las distintas fases de la siguiente forma:

\begin{enumerate}
  \item Investigación de software: Incluye una evaluación de la disponibilidad de software que cubra las especificaciones que deseamos tener. Será necesario verificar si para cada idea de implementación ya existe una solución, y en caso de existir, valorar si merece la pena crear una implementación propia (por cuestiones de aprendizaje, versatilidad o adecuación).

  \item Investigación de hardware: Determinar el marco de opciones clásicas utilizadas al prototipar sistemas de \gls{iot}. Entender los rangos de precio de los mismos y su escalabilidad y protocolos de funcionamiento. Al no crearse hardware nuevo, se seleccionarán las opciones que mejor encajen con los objetivos del proyecto.

  \item Experimentar y prototipar: Aquellas tecnologías que sean reutilizadas deben poder conectarse entre sí, con armonía, y facilidad, siendo, en aquellos puntos que sea necesario, ajustar las configuraciones e incluir desarrollos propios que permitan a todas estas tecnologías operar como un único sistema. Implementar las soluciones propuestas para cada vertiente del proyecto, en un prototipo global, que cubra todos los objetivos propuestos. Iterar el diseño de cada módulo de manera paralela e independiente, evitando que las dificultades aisladas no bloqueen el desarrollo del resto de módulos.

\end{enumerate}

\section{Estructura del documento}
\label{ch:Capitulo1.3}

El documento se estructura como sigue:

\begin{itemize}
  \item El capítulo 2 evalúa la actual situación tecnológica y planteamientos de desarrollo disponibles para crear una suite domótica libre.

  \item El capítulo 3 se centra en la definición de propuesta para crear un prototipo de la suite de domótica, así como funciones y diagramas de despliegue.

  \item El capítulo 4 contiene el diseño de una arquitectura \gls{iot} con aplicación móvil para operar la suite, así como el criterio de selección de equipamiento, despliegue de hardware y el diseño del software para la aplicación móvil.

  \item El capítulo 5 propone casos de uso, donde el prototipo opera y da solución a los problemas planteados.

  \item El trabajo concluye en el capítulo 6 con unas reflexiones sobre el trabajo hecho y unas líneas de trabajo futuro.

\end{itemize}
