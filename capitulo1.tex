\cleardoublepage

\chapter{Introducción}

\section{Presentación de proyecto}
\label{ch:Capitulo1}
El presente documento recoge el proceso de creación de un prototipo como solución integral de domótica programable, gestionada mediante software para plataforma móvil y Web App. La naturaleza del proyecto posee una vertiente asequible y libre. Para poder cumplir con estos objetivos, será necesario que los materiales y dispositivos utilizados para su implementación sean sencillos de adquirir, fáciles de reemplazar, además de tener un bajo coste en precio de adquisición y de tiempo necesario para su instalación, todo ello usando como base software y hardware libre.

\section{Motivación}
\label{ch:Capitulo1.1}

En los últimos años, la domótica ha sufrido un crecimiento acelerado gracias a la interconexión de dispositivos IoT con aplicaciones móviles. Se venden kits de domótica $Plug and Play$, que requieren únicamente de la instalación de una aplicación de movil gratuita y la adquisición de los productos ofertados por los fabricantes que operen en las plataformas de dichas aplicaciones. Una gran competencia entre empresas a surgido a raíz de este planteamiento, ofreciendo una gama extensa de dispositivos y electrodomésticos que pueden combinarse, en algunos casos incluso, interoperar entre los distintos ecosistemas. Esta disputa se está desarrollando en una etapa de incertidumbre, causada por la fase experimental de productos que se ofertan a los consumidores, ya que aún no existe una necesidad real de domótica en las personas, como ocurre, por ejemplo, con los smartphones o tables. Se siguen buscando estrategias de marketing para crear dicha necesidad mediante productos que aportan confort, tomemos por ejemplo los sistemas de iluminación con múltiples configuraciones de intensidad, o traking de actividad, históricos de peso en una báscula. Independientemente de las ideas presentadas ya se están estableciendo unas pautas comunes en todos los actores del sector de la domótica. Es en estas pautas donde aparece nuestra preocupación a la hora de optar por las soluciones con más presencia del mercado (véase Xiamoi, Amazon o Google) que motivan la búsqueda de una suite de domótica que se aleje de los siguientes planteamientos.

En primer lugar, la tendencia es ofrecer dispositivos de distintos rangos de precio, que están diseñados para utilizarse cada uno en los propios ecosistemas privativos de cada marca. Implica supeditarse a las imposiciones técnicas que cada fabricante decida ofrecer, incluyendo la forma en la que funcionan los dispositivos, sin poder modificar las especificaciones y funcionamientos de los mismos, en esencia, cajas negras, que desconocemos su funcionamiento interno, incluyendo la imposibilidad de modificarlos o repararlos por cuenta propia (tal y como se recoge en las cláusulas de uso definidas en los manuales do todas las marcas), lo cual, deja al usuario final a merced de un contrato establecido con los fabricantes, incluyendo su soporte de post-venta y servicio técnico. Por escenificarlo en un ejemplo análogo, si se adquiere un coche, no se imposibilita que se pueda arreglar dicho coche con piezas genéricas, ni que se esté obligado a repararlo a la casa oficial de la marca.

En segundo lugar, la aceptación de las políticas de uso y privacidad de las aplicaciones de las distintas plataformas, que obliga a un uso restringido de los productos según las pautas del vendedor, asi como la cesión de la privacidad del usuario final. Es decir, que toda interacción del usuario con los dispositivos, asi como otros datos personales obtenidos en procesos de registro de sus aplicaciones, incluyendo DCPs de carácter bajo, medios, y alto según que dispositivos, será monitorizados y enviados a servidores para ser procesados, sin tener claro con qué fin. A continuación, algunas de las marcas más reconocidas en el ámbito de consumo para hogar:

Amazon Alexa (Amazon Movile LLC): Su política de privacidad \url{https://www.amazon.es/gp/help/customer/display.html/?nodeId=GA7E98TJFEJLYSFR} indica que se suben grabaciones del usuario a sus servidores para ser procesadas en sus sistemas de reconocimiento de voz y compresión de lenguaje. No se indica expresamente que dichas grabaciones además son incluidas en procesos de entrenamiento de machine learning para mejorar su aplicación. Se indica además que su dispositivo no graba continuamente, salvo por reconocimiento del comando de activación (generalmente el nombre del dispositivo), pero tampoco se especifica cuanto tiempo graba, ni que hace con las filtraciones de voz de otras personas que estén presentes. La cláusula de servicios a terceros resulta bastante ambigua, pero indica que cualquier cesión de permisos a una aplicación de terceros que se integre con Amazon, podrá requerir datos a la misma. Se pueden encontrar más detalles en sus condiciones de uso \url{https://www.amazon.es/gp/help/customer/display.html?nodeId=201809740}, en la misma, podemos observar adicionales clausulas anidadas que redirigen a nuevos enlaces como las condiciones de uso de Amazon España \url{https://www.amazon.es/gp/help/customer/display.html?nodeId=200545940}. Al final es realmente difícil saber a qué se atiene un usuario que adquiere este producto. Su aplicación de movil también requiere un abanico realmente extenso de permisos en el SO de un Smartphone/tablet, incluyendo gestión de cuentas en el dispositivo (añadir o eliminar cuentas), accesos a contactos, ubicación, mensajería, llamadas, almacenamientos, dispositivos de entrada/salida y un largo etcétera que puede consultarse en la APP store correspondiente de Android/IOs.

GoogleHome (Google LLc.): Google lleva años intentando mejorar su calidad de servicio respecto a las leyes europeas de protección de datos. Aun habiendo sonados casos de tratamiento ilegal de DCPs que han terminado en sanciones a la compañía, como los de la AEPD impuestas de hasta 900.000 euros \href{https://www.abc.es/tecnologia/redes/20131219/abci-google-multa-aepd-201312191217.html}{noticia de ABC}, eso no ha impedido la expansión de la compañía a lo largo del mundo. todo ello condicionado por su presencia internacional, que en algunos países son además, proveedores de servicios e infraestructuras de instituciones públicas como ocurre en la Universidad Complutense de Madrid, asi como proyectos conjuntos como la \href{https://biblioteca.ucm.es/google8}{digitalización de la biblioteca complutense}.En el campo de la domótica, lo que respecta a su política de privacidad en su aplicación Google Home, se remite al usuario a las \href{https://policies.google.com/privacy?hl=es}{condiciones generales} de la compañía de Google LLc, para información más concreta sobre $Google Home$ es necesario buscar información concreta en la \href{https://support.google.com/googlehome/answer/7072285?hl=es&ref_topic=7173611}{página de ayuda de Google}. En las misma se afirma la intención de recoger datos (no se especifican de que naturaleza), con el fin de usarse en $machine learning$, afirman que podrían existir aplicaciones de terceros que nutran a Google con más datos (tampoco se especifican que datos ni que aplicaciones de terceros). Aun asi, ofertan la posibilidad de gestionar los datos almacenados por Google en su \href{https://myactivity.google.com/}{gestor de actividad} y en caso de tener la configuración por defecto de recogida de datos que Google utiliza en los SO de Android, los resultados son como poco inquietantes. Un sistema de domótica de Google es perfectamente capaz de determinar con exactitud casi toda tu vida diaria en casa, incluyendo cuando has dormido, cuando has comido, que cosas has visto y que actividades has desarrollado.

Xiaomi Mi (Xiaomi INc.): La empresa china que ha irrumpido en el mercado europeo gracias a sus aplicaciones con UX amigables y precios de dispositivos competitivos, que además admiten múltiples de dispositivos clónicos de fabricantes no adscritos a la marca de Xiaomi. También está haciendo sus adaptaciones para operar en Europa bajo el marco de la RDPG, su \href{https://www.mi.com/es/about/privacy}{política de privacidad}, sobre la recopilación de datos es cuanto menos, ambigua, usando frases como, "podemos recopilar la totalidad o una de la parte que usted nos proporciona" , y en lo que respecta a de que manera se utiliza dicha información, es tan extensa que solo remarcaremos que aparece el nombre de la compañía Facebook en uno de los puntos. Se afirman en que no se venderán los DPCs a terceros salvo aceptación del usuario. La estrategia de la compañía de Xiaomi en su aplicación pasa por ofertar toda clase de servicios, incluyendo chats, foros, pagos en la plataforma de AliPay, etc. La consecuencia de estos servicios genera la tabla más larga de permisos necesarios en un smarthpone/tablet de los ejemplos mencionados. Definitivamente, aquel usuario que instale esta aplicación y permita a todos esos permisos ya puede olvidarse de su privacidad.

En definitiva, toda esta transferencia de datos, en todas las plataformas, esta planteado para ser usadas en servicios en la nube, lo que implica un envió continuo de datos a servicios externos, con medidas de seguridad desconocidas, sin garantías reales de protección de datos y bajo la eterna dependencia de la operatividad de dichos servicios, que según que países, pueden no estar conformes a la legalidad del país en el que vive el usuario final. También hay que tener en cuenta que todas estas empresas se reservan el derecho unilateral de cambiar sus condiciones de uso y política de privacidad cuando crean convenientes sin consentimiento del usuario final. Y merece una mención especial que, las pruebas ejecutadas en las aplicaciones móviles de los ejemplos mostrados coinciden en una misma máxima, contra más restrictiva sea la configuración de privacidad por parte del usuario, menor será la utilidad de la aplicación. Este documento no profundizara más en los problemas de privacidad de datos de los usuarios para estas aplicaciones, ya que, de por sí, se requiere un estudio minucioso a parte que debe apoyarse debidamente con una base de conocimiento legal que excede las competencias adquiridas en una carrera de vertiente tecnológica como la ingeniería informática. Sin embargo, aquellos alumnos de la facultad de ingeniería informática que hayan cursado el itinerario tecnológico de grado que incluye la materia de auditoria informática, como es el caso de los autores de este documento, y que por consecuencia poseen una base conceptual sobre los conceptos de los DCPs, su tratamiento y la regulación de la LOPD y RGPD en España por parte de la AEPD, podemos concluir, que todas estas aplicaciones sin ser ilegales, se encuentran demasiado cerca de la ilegalidad como para considerarse realmente confiables y comprometidas con los datos privados de sus usuarios.

Y en último lugar, como motivación adicional para el desarrollo de un suite domótica independiente y libre, se encuentra el problema que bautizaremos como "Miles kilómetros por metros", es decir, que para encender una bombilla a un metro del usuario, la operativa de la infraestructura necesaria para que la acción ocurra, implica que los datos de dicha acción, tienen que viajar miles de kilómetros, hasta llegar a los servidores necesario, para algo tan sencillo como encender un interruptor. Esto carece de sentido si no existe intención de usar los datos para "machine learning" o para su procesamiento en marketing, venta o traking a terceros, además, en caso de caída de la red de internet (Ya sea por el ISP, por un bloqueo del servicio en origen o destino, etc) no se puede operar los dispositivos en la red local, lo cual no está justificado. Es entendible que ante desconexión de la red de internet no puedas operar de manera remota la domótica del hogar, pero un router doméstico puede seguir ofreciendo operatividad a la red local de hogar, incluyendo la gestión domótica desde dentro de la red.

Por todo esto, queremos investigar y crear un prototipo de solución domótica (Suite domótica en adelante) que evite estas pautas anteriormente descritas. Sustentado por un software libre, con unas librerías accesibles de manera pública, basado en un hardware fácil de adquirir y que con una base fundamental de conocimientos de electrónica, dicha suite pueda ser manipulada y personalizada con relativa facilidad. Buscaremos una solución integral de domótica que incluya el software necesario para operar localmente en casa (y a través de la red de internet), con una APP, que no necesite de servicios externos, ni de la aceptación de políticas de uso privativas y opacas.

No se pretende crear una solución disruptiva en el mercado de la domótica, que enfrente las soluciones ya existentes ofertadas por otras marcas, ni aportar un protocolo nuevo de comunicaciones entre dispositivos IoT, sino en conocer los requisitos necesarios para la creación de una suite domótica y la capacidad de un usuario final, el cual, disponiendo de una documentación adecuada, pueda instalar su propio sistema de domótica personalizado.

Las soluciones que pueden adquirirse actualmente en el mercado, tras lo años de prueba y error, han alcanzado un proceso de instalación muy sencillo para los usuarios finales. Esto, sin embargo, será difícil de abordar en este proyecto, ya que siempre será necesario que el usuario final disponga de conocimientos específicos de informática para interpretar los pasos que estarán documentados, peor es posible alcanzar un punto intermedio, que requiera de unos conocimientos mínimos, pero que este lo suficientemente guiado como para ser trivial. En todo caso, se intentará minimizar en la medida de lo posible todos los pasos necesarios para montar la infraestructura, incluyendo la instalación de software y la programación de scripts, para que el prototipo pueda ser exportado con facilidad y replicarse nuevamente ahorrando tiempo, y simplificando el proceso.

Para disponer de una base tecnológica sólida sobre la que crear esta solución, se ha optado por utilizar una plataforma de hardware amigable como es Raspberry Pi y Arduino, que disponen de una extensa comunidad de usuarios y documentación. No solo se puede reaprovechar gran parte del trabajo ya creado en programación de scripts para componentes de hardware como sensores y actuadores, sino que cumplen con el objetivo de ofrecer una base de hardware/software libre. Adicionalmente se tratará de alcanzar una cierta descentralización de los dispositivos y la propia raspberry, basándose en el concepto de nodo principal, que habitualmente se observa en las plataformas de pago.

Dichos planteamientos se basan en que todo sensor/actuador que forme parte de red de dispositivos de una solución de domótica actual, es gestionada a través de un nodo. En vez de conectar los dispositivos inalámbricos a el router de la casa, se conectan al nodo y este, a su vez, es quien se conecta a la red local del hogar, para asi conectarse con los servicios externos. En general, las distintas plataformas has alcanzado un acuerdo no formalizado de actuación que funciona de la siguiente forma. El usuario final compra un nuevo dispositivo, lo enciende, dejándolo en un estado de "inclusión" a la red domótica, después, desde la aplicación de movil, se indica al nodo, que se quiere añadir un nuevo dispositivo, y tras seguir las indicaciones, el dispositivo se registra en la red del nodo. Esto, sin embargo, tiene algunos inconvenientes en el proceso de "inclusión", y aunque la probabilidad es baja, puede suceder que dos nodos de distintas viviendas, que están registrando dispositivos simultáneamente, terminasen, registrando un dispositivo que no les corresponde. Esto es una vulnerabilidad de seguridad grave.

Se ha planteado este problema, junto con las 3 motivaciones principales, para crear un proceso de "inclusión" de dispositivos al nodo, que parta de una conexión alámbrica (vía USB) y resuelva este inconveniente, y simplifique el proceso de las soluciones privadas, que en ocasiones pueden fallar. Respecto a los dispositivos que se pueden incluir en la red del nodo, para el desarrollo de este proyecto nos limitaremos a un par de casos de uso, esto es un sensor de temperatura y humedad conectado directamente al nodo, incluyendo un altavoz y un sistema de luces que cubrirán un amplio espectro de opciones, y un dispositivo inalámbrico de un sensor/actuador.


\section{Objetivos}
\label{ch:Capitulo1.2}

Diseñar e implementar una solución integral de domótica modular y autocontenida, que permita mediante las indicaciones de este documento, replicar la instalación y configuración de dicha solución.
\begin{itemize}
  \item Instalación y configuración de un stack de servicios que permitan controlar la suite de domótica desde un servidor alojado en la raspberry Pi.

  \item Desarrollo de una aplicación movil que permitir al usuario interactuar mediante una API-REST con dicho servidor para ejecutar las acciones y configuraciones

  \item Implementar con una placa de arduino un dispositivo inalámbrico con un sensor que interactúe con nuestra suite de domótica.

  \item Desarrollar un sistema de conexión de dispositivos inalámbricos a nuestra suite de domótica.

  \item Agrupar y exportar el proyecto en una imagen fácil de clonar en otra raspberry con un manual sencillo.
\end{itemize}

\section{Plan de trabajo}
\label{ch:Capitulo1.3}

El diseño de una suite de domótica, aun creándose desde cero, debería de poder aprovechar al máximo las tecnologías y desarrollos de software libres existentes, ya que este es, precisamente, el mayor potencial del desarrollo colaborativo tan característico del software libre, que incluyen una extensa comunidad que día a día mejoran el rendimiento y seguridad de cada uno de los modulos de los que se componen. Esto implica un estudio previo de las diferentes opciones disponibles, y una selección del software/hardware que mejor se ajuste a nuestros objetivos, más detallados en la siguiente sección. Podemos separar las distintas fases de la siguiente forma:

\begin{enumerate}
  \item Investigación: Incluye una evaluación de la disponibilidad de software que cubra las especificaciones que deseamos tener. Sera necesario verificar si, para cada idea de implementación ya existe una solución, y en caso de existir, valorar si merece la pena crear una implementación propia (por cuestiones de aprendizaje o versatilidad, adecuación), o utilizar la ya existente.

  \item Control de versiones: utilizar repositorios con control de versiones que permitan el desarrollo simultaneo de distintos elementos del proyecto sin que suponga colisiones a la hora de juntar los desarrollos, permitiendo separar y clasificar cada uno de estos elementos, para manejar distintos versionados.

  \item Experimentar: Aquellas tecnologias que sean reutilizadas deben poder conectarse entre sí, con armonía, y facilidad, siendo, en aquellos puntos que sea necesario, ajustar las configuraciones e incluir desarrollos propios que permitan a todas estas tecnologias operar como un único sistema.

  \item Prototipar: Implementar las soluciones propuestas para cada vertiente del proyecto, en un prototipo global, que cubra todos los objetivos propuestos. Iterara el diseño de cada módulo de manera paralela e independiente, evitando que las dificultades aisladas no bloqueen el desarrollo del resto de modulos.

  \item Publicar: Encapsular el prototipo en un formato exportable y fácil de instalar
\end{enumerate}

\section{Estructura del documento}
\label{ch:Capitulo1.4}

El documento se estructura como sigue:

\begin{itemize}
  \item El capitulo 2 evalua la actual situacion tecnologica y planteamientos de desarrollo disponibles para crear una suite de domotica libre.

  \item El capitulo 3 se centra en la definicion de propuesta para crear un prototipo de la suite de domotica.

  \item El capitulo 4 contiene el diseño de una arquitectura IoT con aplicacion movil para operar la suite, asi como el criterio de seleccion de equipamiento.

  \item El capitulo 5 se dedica al diseño del software que debe correr dentro de la arquitectura asi como su configuracion e implentación.

  \item El capitulo 6 propone casos de uso, donde el prototipo opera y da solución a los problemas planteados.

  \item El trabajo concluye con unas reflexiones sobre el trabajo hecho y unas líneas de trabajo futuro.
\end{itemize}
