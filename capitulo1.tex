\cleardoublepage

\chapter{Motivación}

%\label{ch:chapter1}
\label{makereference}
El presente documento recoge el proceso de creación del prototipo de una solución integral de domótica programable, gestionada mediante software para plataforma móvil y Web App. Como valor añadido al producto, se plantea cubrir una serie de objetivos adicionales que permitirán a esta solución ahorrar costes económicos y gastos innecesarios de los recursos naturales. La naturaleza del proyecto posee una vertiente ecológica, sostenible, asequible y libre. Para poder cumplir con estos valores, será necesario que los materiales utilizados para su implementación sean amigables con el medio ambiente, además de encontrar un equilibrio razonable en los costes de implementación y el uso como base fundamental de software/hardware libre.

\section{Motivación}
\label{makereference1.1}

Generalmente el consumo de recursos naturales así como el cuidado del medio ambiente se presenta como una responsabilidad de los gobiernos y las empresas, pero los propios ciudadanos somos parte del problema también. Aunque las compañías se aseguran de medir con exactitud el gasto a facturar del suministro consumido, esto no implica que los consumidores sepan como y cuanto están aprovechando dicho consumo. Existen muchos factores por los cuales se derrochan recursos en un hogar, desde malos hábitos, descuidos o una falsa sensación de control.

Con un control digitalizado y una programación adecuada, una casa puede ejecutar una serie de acciones que implican un menor consumo de recursos, un mejor aprovechamiento del suministro de agua/luz y por consecuencia, un ahorro en el bolsillo del ciudadano a la par que un modo de vivir más sostenible.

Actualmente existen soluciones ofertadas por empresas privadas cuyos productos tiene por objetivo aportar confort al hogar mediante el control remoto o la programación de los dispositivos electrónicos del hogar, sin embargo, sus productos privativos y prácticas empresariales poco éticas despiertan suspicacias entre la población, la cual no quiere renunciar  a su privacidad a cambio de automatismos.

Los autores de este documento coinciden en la necesidad de crear soluciones integrales o parciales para el hogar, que faciliten la tarea de gestión doméstica.


\section{Objetivos}
\label{makereference1.2}

Diseñar una solución tecnológica modular y personalizable a las necesidades de cada hogar en función del presupuesto y tipo de vivienda. 

Definición de casos de uso. (al menos 3)
Implementación efectiva de servicios
Scripting de bajo nivel
Scripting de comunicación con la BBDD	
Estrategia de APP para lado cliente

SEPTIEMBRE:
Control de versiones con GitFlow
Look and feel de la APP (Vista principal HOME, vista MORE, vista LOG)
Infraesctrucuta opertiva
Un caso de uso operativo a nivel de BBDD


\section{Equipación}
\label{makereference1.3}

Existen múltiples niveles de implementación del prototipo planteado en este documento. En función de la cantidad de módulos operativos se requerirá una mayor cantidad de hardware para la sensorización y los actuadores implicados. El nivel mas básico e imprescindible implica un ordenador con SO Linux que actuara como controlador de la infraestructura de dispositivos que dan forma al sistema en su conjunto. Esto permite un gran abanico de opciones, el presente documento explica la implementación mediante un ordenador compacto de la marca Raspberry Pi. La selección particular de este hardware se apoya en 2 características esenciales en el desarrollo de este proyecto, es barato y de bajo consumo eléctrico. Además goza de presencia en el mercado de dispositivos, por lo cual es fácil de adquirir y a acumulado una extensa comunidad de usuarios que facilitan su uso mediante tutoriales y experimentos. Como motivos adicionales se encuentra su reducido tamaño que permite ubicarlo con facilidad en lugares estrechos o difícilmente accesibles y su imperceptible ruido al operar.

\section{Criterio de selección del equipamiento y Software}
\label{makereference1.4}
El modelo concreto para el desarrollo del prototipo es Rapsberry Pi3b+ que dispone de capacidad de procesador y memoria RAM suficiente para operar todo el software necesario, este modelo no integra un almacenamiento interno para el usuario, pero su interfaz incluye una ranura de tarjetas micro-SD compatible con todas las opciones de tamaño de almacenamiento disponibles en el mercado. Se precisan de al menos 16 GB de espacio disponible en la memoria del sistema, y es recomendable exceder este mínimo siempre que sea posible, ya que la acumulación de datos con el paso del tiempo por parte del dispositivo crecerá indefinidamente.

Tambien sera encesario incluir que hardware y que software (SO, paquetes, entronos de desarrollo, etc) usaremos y una jutificación apra cada caso.


\section{Esquema de trabajo}
\label{makereference1.5}
Aquí hablaríamos de como hemos organizado el proyecto, nuestras fechas, metodología ágil, sistema de repositorios, aplicaciones necesarias para el desarrollo del trabajo, bla bla bla...

\section{Instalación y configuración del nodo principal}
\label{makereference1.6}
 Utilizando los repositorios de distribuciones oficiales de Sistemas operativos de Raspberry Pi, descargamos la versión "Lite" de Raspbian. Para establecer una conexión SSH por terminal es necesario crear un fichero con nombre "ssh" en la raiz de la unidad de almacenamiento donde previamente se haya montado la imagen descargada. La distribución de Raspbian originalmente estaba configurada por defecto con la conexión de SSH abierta en el puerto 22 pudiendo accederse con el usuario \path{pi} y la contraseña \path{raspberry}. Este dato era ignorado por los usuarios menos experimentados y esto supuso una brecha de seguridad en todos las distribuciones que no fueron configuradas a posteriori por los usuarios según las indicaciones de la propia \href{https://www.raspberrypi.org/documentation/configuration/security.md}{ documentación de Raspberry}. En el primer arranque del SO de la Raspberry se establecerán las configuraciones básicas para las sucesivas conexiones SSH basadas en autenticación con claves privadas.
 
 De las estrategias disponibles para esta configuración, se ha determinado crear las claves en el equipo remoto que se conectara a la Raspberry, entregando mediante la primera conexión SHH con terminal la clave pública y almacenando la clave privada en el equipo remoto, reduciendo así el riesgo de ser expuesta fuera del dominio local del equipo. Para disponer de flexibilidad de conexión independientemente del SO del equipo remoto, la clave privada tendra un formato OpenSSH, fácil de incluir en SO Windows ya sea mediante conversión de la clave a formato PPK o como fichero accesible para aplicaciones de desarrollo,transferencias de ficheros, y/o control de versiones que integran conexiones SSH configurables (GitHub, Filezila, Eclipse, etc).

En Windows puede utilizarse aplicaciones de gestión de claves como 'puttygen'. En la sección de parámetros de generación de las claves se define SSH-2 RSA de 2048bits y en la sección de acciones pulsamos en genérate. Tras unos movimientos aleatorios de ratón se generara la clave publica en el área de texto. Se deben guardar ambas claves mediante los botones 'save public key' y 'save private key', esta ultima sera guardada con una contraseña definida en los inputs de la aplicación para tal fin. La clave privada sera almacenada en formato PPK para ser rápidamente usada por aplicaciones de conexión por terminal remota como 'putty'. Es recomendable exportar dicho fichero a formato OpenSSH mediante la misma aplicación de generación de claves, en la sección 'Conversions' del menú desplegable y seleccionar la opción 'Export OpenSSH key', definimos  un nombre para el fichero de salida y pulsamos 'save'. Esta misma operación puede realizarse desde una terminal de un SO Linux mediante el comando 'ssh-keygen -t rsa' que generara por defecto la claves en el directorio \path{/home/username/.ssh/} bajo el nombre \path{id_rsa.pub} e \path{id_rsa} para las claves publica y privada respectivamente.

